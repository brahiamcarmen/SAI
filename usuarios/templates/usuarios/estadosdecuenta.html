{% extends 'usuarios/base_usuario3.html' %}
{% load static %}
{% block styles %}
{% endblock %}
{%block title %} <title>Estados de cuenta</title> {%endblock%}
{% block content %}
{% load humanize %}
{% include 'usuarios/alerts.html' %}
<div class="page-body">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2">
        <div class="row">
          <div class="col-md-12">
              <h3 class="subheader">Estados de facturacion</h3>
                    <div class="card">
                      <div class="card-body">
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>
                          Vigentes: <strong>{{facemi|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Pagas: <strong>{{facpg|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="17" cy="17" r="4" /><path d="M17 13v4h4" /><path d="M12 3v4a1 1 0 0 0 1 1h4" /><path d="M11.5 21h-6.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v2m0 3v4" /></svg>
                          Vencidas: <strong>{{facven|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M11 14h1v4h1" /><path d="M12 11h.01" /></svg>
                          Anuladas: <strong>
                            {{facanu|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                          Total: <strong>
                            {{totalfac|intcomma}}</strong>
                        </div>
                      </div>
                    </div>
          </div>
           <div class="col-md-12" style="margin-top:0.5rem">
              <h3 class="subheader">Acuerdos de pago</h3>
                    <div class="card">
                      <div class="card-body">
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>
                          Pagos: <strong>{{acuerpa|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Pendientes: <strong>{{acuerpen|intcomma}}</strong>
                        </div>

                        <div class="mb-2">
                          Total: <strong>
                            {{acuerdos|intcomma}}</strong>
                        </div>
                      </div>
                    </div>
          </div>
          <br>
           <div class="col-md-12" style="margin-top:0.5rem">
          <h3 class="subheader">Opciones disponibles</h3>
          <div class="row">
            <div class="col-md-12" style="margin-top: 0.5rem">
                <a href="#" class="btn btn-sm btn-red btn-pill w-100" data-bs-toggle="modal" data-bs-target="#modal-danger">
                    Generar cobro de conceptos
                  </a>
            </div>
            <div class="col-md-12" style="margin-top: 0.5rem">
                <a href="{% url 'usuarios:varias' %}" class="btn btn-sm btn-dark btn-pill w-100">
                    Generar suspenciones
                  </a>
            </div>
            <div class="col-md-12" style="margin-top: 0.5rem">
                <a href="#" class="btn btn-sm btn-dark btn-pill w-100" data-bs-toggle="modal" data-bs-target="#acuerdo">
                    Registrar acuerdo/financiación
                  </a>
            </div>
            <div class="col-md-12" style="margin-top: 0.5rem">
               <a href="{% url 'usuarios:generadorfacturas' %}" class="btn btn-sm btn-dark btn-pill w-100">Generar facturacion</a>
            </div>
            <div class="col-md-12" style="margin-top: 0.5rem">
               <a href="{% url 'usuarios:facturamasiva' %}" class="btn btn-sm btn-green btn-pill w-100">Descargar facturas</a>
            </div>          
          </div>
      </div>
        </div>

      </div>
      <div class="col-md-3">
        <h3 class="subheader">Cuentas por cobrar</h3>
                    <div class="card">
                      <div class="card-body">
                        <div class="mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>
                          Aporte fijo: <strong>${{apf|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Consumo basico: <strong>${{bss|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Complementarios: <strong>${{comp|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Suspenciones: <strong>${{sus|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Reconexiones: <strong>${{re|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Recargos: <strong>${{recar|intcomma}}</strong>
                        </div>
                        <hr>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Subsidios: <strong>-{{sub|intcomma}}</strong>
                        </div>
                        <hr>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Acuerdos de pago: <strong>${{acuer|intcomma}}</strong>
                        </div>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Saldos anteriores: <strong>${{anter|intcomma}}</strong>
                        </div>
                        <hr>
                        <div class="mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 15l2 2l4 -4" /></svg>
                          Sin facturar: <strong>${{sinfac|intcomma}}</strong>
                        </div>
                        <hr>

                        <div class="mb-2">
                          Total: <strong>
                            ${{totales|intcomma}}</strong>
                        </div>
                      </div>
                    </div>
      </div>
      <div class="col-md-7">
                        <h3 class="subheader">Acuerdos de pago</h3>
                    <div class="text-center table-responsive" style="height:45rem">
                      <table class="table table-bordered table-striped table-hover" id="dataTable" width="100%" cellspacing="0">
                          <thead>
                              <tr>
                                  <th>No registro</th>
                                  <th>Tipo</th>
                                  <th>Estado</th>
                                  <th>Valor</th>
                                  <th>T Cuotas</th>
                                  <th>Cuotas P</th>
                                  <th>Saldo pendiente</th>
                                  <th>Cuota</th>
                                  <th>Fecha</th>
                                  <th>Descripcion</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for i in acuerdospagos %}
                                  <tr class="odd gradeX">
                                      <td>{{ i.IdAcuerdo }}</td>
                                      <td>{{ i.Tipo }}</td>
                                      <td>
                                          {% if i.Estado == "Pendiente" %}
                                              <span class="badge bg-danger-lt">Pendiente</span>
                                          {% elif i.Estado == "Pago" %}
                                              <span class="badge bg-success-lt">Pago</span>
                                          {% else %}
                                              <span class="badge bg-info-lt">Anulado</span>
                                          {% endif %}
                                      </td>
                                      <td>${{ i.Valor|intcomma }}</td>
                                      <td>{{ i.CantCuotas }}</td>
                                      <td>{{ i.CuotasPendientes }}</td>
                                      <td>${{ i.ValorPendiente|intcomma }}</td>
                                      <td>${{ i.Cuota|intcomma }}</td>
                                      <td>{{ i.FechaExpe|date:"d/m/Y" }}</td> <!-- Formato de fecha modificado -->
                                      <td>{{ i.Descripcion }}</td>
                                  </tr>
                              {% endfor %}
                          </tbody>
                      </table>

                                          </div>   
      </div>
    </div>
    <br>






  </div>
</div>

      </div>
    </div>
    <div class="modal modal-blur fade" id="modal-danger" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          <div class="modal-status bg-danger"></div>
          <div class="modal-body text-center py-4">
            <!-- Download SVG icon from http://tabler-icons.io/i/alert-triangle -->
            <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v2m0 4v.01" /><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" /></svg>
            <h3>Estas seguro?</h3>
            <div class="text-muted">¿Realmente quieres generar la facturacion de conceptos? Lo que hagas no se puede deshacer.</div>
          </div>
          <div class="modal-footer">
            <div class="w-100">
              <div class="row">
                <div class="col"><a href="#" class="btn w-100" data-bs-dismiss="modal">
                    Cancelar
                  </a></div>
                <div class="col"><a href="{% url 'usuarios:crearconceptos' %}" class="btn btn-danger w-100">
                  Generar
                  </a></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal modal-blur fade" id="acuerdo" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Agregar financiacion</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="post" enctype="multipart/form-data" class="card">
            {% csrf_token %}
          <div class="modal-body">
            <div class="row mb-3 align-items-end">
              <div class="col">
                <label class="form-label">Matricula</label>
                <input type="text" name="Matricula" class="form-control" />
              </div>
            </div>
            <div class="row mb-3 align-items-end">
              <div class="col">
                <label class="form-label">Valor a financiar</label>
                <input type="number" name="Valor" class="form-control" />
              </div>
            </div>
            <div class="row mb-3 align-items-end">
              <div class="col">
                <label class="form-label">Cuotas</label>
                <select name="Cuotas" class="form-control" >
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="12">12</option>
                  <option value="24">24</option>
                  <option value="36">36</option>
                </select>
              </div>
            </div>
            <div>
              <label class="form-label">Descripcion</label>
              <textarea class="form-control" name="Descripcion"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Registrar</button>
          </div>
        </form>
        </div>
      </div>
    </div>
{% endblock %}
{% block scripts %}
      <script>
      // @formatter:off
      document.addEventListener("DOMContentLoaded", function () {
        window.ApexCharts && (new ApexCharts(document.getElementById('chart-demo-pie'), {
          chart: {
            type: "donut",
            fontFamily: 'inherit',
            height: 270,
            sparkline: {
              enabled: true
            },
            animations: {
              enabled: false
            },
          },
          fill: {
            opacity: 1,
          },
          series: [{{sumaop}}, {{sumasus}}],
          labels: ["Operativos","Suspendidos"],
          grid: {
            strokeDashArray: 6,
          },
          colors: ["#B8F5A4","#739668"],
          legend: {
            show: true,
            position: 'bottom',
            offsetY: 12,
            markers: {
              width: 10,
              height: 10,
              radius: 100,
            },
            itemMargin: {
              horizontal: 9,
              vertical: 9
            },
          },
          tooltip: {
            fillSeriesColor: false
          },
        })).render();
      });
      // @formatter:on
    </script>
{% endblock %}